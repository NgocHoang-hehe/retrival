import numpy as np
from sklearn.feature_extraction.text import TfidfVectorizer
from underthesea import word_tokenize
import re

def load_stopwords(file_path):
    with open(file_path, 'r', encoding='utf-8') as f:
        return set(f.read().splitlines())

# Giả sử bạn đã có file stopwords
stopwords = load_stopwords('vietnamese-stopwords.txt')

def preprocess_text(text):
    # Loại bỏ các ký tự đặc biệt
    text = re.sub(r'[^\w\s]', '', text)

    tokens = word_tokenize(text)
    return ' '.join([token for token in tokens if token.lower() not in stopwords])

def rocchio_query_expansion(query, relevant_docs, irrelevant_docs, all_docs, alpha=0.8, beta=0.15, gamma=0.05):
    # Tiền xử lý tất cả văn bản
    processed_query = preprocess_text(query)
    processed_docs = [preprocess_text(doc) for doc in all_docs]
    
    # Khởi tạo TfidfVectorizer với n-grams và tokenizer tùy chỉnh
    vectorizer = TfidfVectorizer(ngram_range=(1, 2), tokenizer=word_tokenize)
    
    # Fit và transform tất cả tài liệu
    tfidf_matrix = vectorizer.fit_transform(processed_docs)
    
    # Transform truy vấn ban đầu
    query_vector = vectorizer.transform([processed_query]).toarray()[0]
    
    # Tính vector trung bình của tài liệu liên quan
    relevant_vectors = vectorizer.transform([preprocess_text(doc) for doc in relevant_docs]).toarray()
    relevant_centroid = np.mean(relevant_vectors, axis=0)
    
    # Tính vector trung bình của tài liệu không liên quan
    irrelevant_vectors = vectorizer.transform([preprocess_text(doc) for doc in irrelevant_docs]).toarray()
    irrelevant_centroid = np.mean(irrelevant_vectors, axis=0)
    
    # Áp dụng công thức Rocchio
    new_query_vector = (alpha * query_vector + 
                        beta * relevant_centroid - 
                        gamma * irrelevant_centroid)
    
    # Chọn các từ khóa mới
    top_terms_indices = new_query_vector.argsort()[-20:][::-1]
    feature_names = vectorizer.get_feature_names_out()
    new_query_terms = [feature_names[i] for i in top_terms_indices]  # Chỉ lấy các từ, không lấy điểm số
    
    print("Top terms:", new_query_terms)  # In ra để kiểm tra
    
    return post_process_query(new_query_terms, query, max_new_terms=2)

def post_process_query(query_terms, original_query, max_new_terms=2):
    original_tokens = set(word_tokenize(original_query))
    processed_terms = [term for term in original_tokens]
    
    # Thêm các từ mới có ý nghĩa
    new_terms = []
    for term in query_terms:
        if term not in original_tokens and term not in new_terms:
            new_terms.append(term)
            if len(new_terms) == max_new_terms:
                break
    
    # Kết hợp các từ gốc và từ mới
    final_terms = processed_terms + new_terms
    
    # Loại bỏ trùng lặp và giữ thứ tự
    final_terms = list(dict.fromkeys(final_terms))
    
    return ' '.join(final_terms)

# Ví dụ sử dụng
query = "iphone 13"
relevant_docs = ["Dòng iPhone 13 tại Việt Nam hiện còn iPhone 13 được bán chính hãng nhưng iPhone 13 Pro Max vẫn đang rất hot vởi trang bị mạnh mẽ cao cấp không kém iPhone 15 Pro Max nhiều nhưng giá bán lại siêu rẻ.\
                  iPhone 13 là bước phát triển mạnh mẽ của Apple với dòng iPhone tai thỏ khi hoàn thiện công nghện \
                  này tới tối đa trước khi chuyển sang iPhone 14 với sự khởi đầu của Dynamic Island. \
                 Chính vì vậy iPhone 13 tiêu chuẩn hiện là chiếc iPhone đáng mua nhất hiện nay với giá bán hợp lý cho trang bị. \
                 Trong khi đó iPhone 13 Pro và iPhone 13 Pro Max lại đang làm mưa làm gió trên thị tường máy cũ nhờ trang bị quá mạnh không thua iPhone 15 Pro mới quá nhiều nhưng giá rẻ như bèo. Về cơ bản, iPhone 13 Pro Max và iPhone 13 Pro sở hữu quá nhiều trang bị cao cấp như chip A15 Bionic vẫn quá mạnh và đáp ứng tốt mọi nhu cầu của người dùng một cách ổn định, mượt mà. Camera cua máy với bộ ba ống kính có đủ zoom 3x, rộng và siêu rộng, có thể quay xóa phông vẫn là những thứ không thay đổi quá nhiều qua các thế hệ iPhone 14 và 15 kế tiếp. Trong khi đó, iPhone 13 với mức giá chỉ hơn 13 triệu đồng trong khi có màn OLED với tai thỏ đã thu gọn, camera với tính năng quay xóa phông xịn xò thực sự là lựa chọn khá hời hiện nay cho khách Việt. Dòng iPhone 13 tại Việt Nam hiện còn iPhone 13 được bán chính hãng nhưng iPhone 13 Pro Max vẫn đang rất hot vởi trang bị mạnh mẽ cao cấp không kém iPhone 15 Pro Max nhiều nhưng giá bán lại siêu rẻ. iPhone 13 là bước phát triển mạnh mẽ của Apple với dòng iPhone tai thỏ khi hoàn thiện công nghệ này tới tối đa trước khi chuyển sang iPhone 14 với sự khởi đầu của Dynamic Island. Chính vì vậy iPhone 13 tiêu chuẩn hiện là chiếc iPhone đáng mua nhất hiện nay với giá bán hợp lý cho trang bị. Trong khi đó iPhone 13 Pro và iPhone 13 Pro Max lại đang làm mưa làm gió trên thị tường máy cũ nhờ trang bị quá mạnh không thua iPhone 15 Pro mới quá nhiều nhưng giá rẻ như bèo. Bảng giá iPhone 13 trong tháng 8/2024 iPhone 13 (mới) iPhone 13 128GB: 13.19 triệu đồng iPhone 13 256GB: 16.29 triệu đồng iPhone 13 Pro Max cũ iPhone 13 Pro Max 128GB: 14.95 triệu đồng. iPhone 13 Pro Max 256GB: 16.05 triệu đồng iPhone 13 Pro Max 512GB: 17.35 triệu đồng iPhone 13 Pro cũ iPhone 13 Pro 128GB: 12.99 triệu đồng iPhone 13 Pro 256GB: 14.39 triệu đồng. iPhone 13 Pro 512GB: 15.19 triệu đồng iPhone 13 Mini (cũ) iPhone 13 Plus 128GB: 7.59 triệu đồng iPhone 13 Plus 256GB: 8.59 triệu đồng. Về cơ bản, iPhone 13 Pro Max và iPhone 13 Pro sở hữu quá nhiều trang bị cao cấp như chip A15 Bionic vẫn quá mạnh và đáp ứng tốt mọi nhu cầu của người dùng một cách ổn định, mượt mà. Camera cua máy với bộ ba ống kính có đủ zoom 3x, rộng và siêu rộng, có thể quay xóa phông vẫn là những thứ không thay đổi quá nhiều qua các thế hệ iPhone 14 và 15 kế tiếp. Trong khi đó, iPhone 13 với mức giá chỉ hơn 13 triệu đồng trong khi có màn OLED với tai thỏ đã thu gọn, camera với tính năng quay xóa phông xịn xò thực sự là lựa chọn khá hời hiện nay cho khách Việt. Smart Phone - Điện thoại Nút bấm mới trên iPhone 16 có gì \'hot\' mà khiến cộng đồng mạng sốt điên đảo 8 giờ trước Smart Phone - Điện thoại Rò rỉ thiết kế đỉnh nóc, kịch trần của Galaxy S25 Ultra, đẹp ăn đứt iPhone 16 Pro Max 22 giờ trước Tư vấn A-Z Đây là mẫu iPhone màn OLED, tai thỏ rẻ nhất thị trường, chỉ hơn 3 triệu, camera zoom như iPhone 15 hôm qua Tư vấn A-Z Đây là iPhone màn OLED cao cấp còn được hỗ trợ iOS giá rẻ nhất Việt Nam, vẫn mượt như iPhone 15 hôm qua Link gốc https://sohuutritue.net.vn/bang-gia-iphone-13-thang-8-2024-iphone-13-dap-hop-sieu-re-iphone-13-pro-max-van-cuc-hot-vi-qua-beo-d234242.html Tag: giá iphone 13 iphone 13", 
                ]
irrelevant_docs = ["Ngoại hạng Anh dùng iPhone thay VAR bắt việt vị Từ mùa 2024-2025, giải Ngoại hạng Anh sẽ dùng hàng chục iPhone 14 hoặc mới hơn để phân tích các tình huống bắt việt vị hỗ trợ trọng tài. Theo Wired, hệ thống mới có tên Dragon, được phát triển bởi công ty dữ liệu và công nghệ thể thao Genius Sports và Second Spectrum. Ban tổ chức Premier League sẽ sử dụng trong tất cả trận đấu bắt đầu từ mùa giải này để thay thế hệ thống VAR với các tình huống bắt việt vị. Hàng chục iPhone đời mới sẽ giúp trọng tài đưa ra quyết định trong các tình huống bắt việt vị. Ảnh: DailyMail Công nghệ mới áp dụng dựa trên ít nhất 28 điện thoại đời iPhone 14 trở lên đặt xung quanh sân. Thiết bị sẽ được bọc trong vỏ chống nước và được trang bị quạt làm mát để hoạt động thời gian dài. Các máy sẽ quay video tốc độ khung hình cao từ nhiều góc độ khác nhau trên sân và truyền tín hiệu về phòng điều khiển. Vị trí điện thoại của Apple có thể khác nhau ở mỗi sân nhưng đặt cố định khi trận đấu diễn ra, tránh tình huống phải hiệu chỉnh lại phần mềm điều khiển. Điều làm Dragon trở nên độc đáo là khả năng theo dõi lượng lớn dữ liệu cho mỗi cầu thủ. Hệ thống có thể theo dõi từ 7.000 đến 10.000 điểm trên mỗi cầu thủ, ghi lại các chi tiết như đường nét cơ thể, khối lượng cơ và thậm chí cấu trúc xương. Mức độ chi tiết này giúp đảm bảo các quyết định việt vị chính xác hơn. Hệ thống ghi lại ở tốc độ tới 100 khung hình/giây giúp cung cấp các góc nhìn rõ hơn về thời điểm bóng rời chân cầu thủ chuyền bóng hay vị trí tương quan giữa hậu vệ và tiền đạo. Các máy iPhone gửi dữ liệu đến phần mềm AI để phân tích cảnh quay nhằm phát hiện tình huống việt vị. Tuy nhiên, ngay cả với công nghệ tiên tiến này, trọng tài vẫn sẽ là người đưa ra quyết định cuối cùng. Điều đó đồng nghĩa Dragon chỉ hỗ trợ chứ không có nhiệm vụ thay thế hoàn trọng tài. Ngoài cải thiện độ chính xác, giảm tranh cãi trong các tình huống phát hiện việt vị, Dragon có thể thêm nhiều công dụng khác trong tương lai như tạo ra bản sao kỹ thuật số của các cầu thủ để phân tích hành động. Chúng cũng có thể được sử dụng để hỗ trợ trọng tài trong những tình huống khác trên sân như thổi phạt, rút thẻ. Hệ thống Dragon sử dụng iPhone nhưng có thể theo dõi từ 7.000 đến 10.000 điểm trên mỗi cầu thủ. Ảnh: Genius Sports Công ty phát triển cho biết iPhone ngày nay mạnh mẽ như những siêu máy tính cách đây hơn 20 năm. Trong khi các hệ thống theo dõi quang học hiện đại khác đòi hỏi cáp quang đắt tiền, máy chủ để kết nối hay máy tính có nhiệm vụ quản lý dữ liệu được thu thập, một chiếc smartphone 1.000 USD có thể tự xử lý cả hai nhiệm vụ đó khá tốt. Đại diện Genius Sports cho biết hệ thống mới được nhiều giải bóng đá lớn khác quan tâm do dễ tùy biến, mức chi phí đầu tư không quá lớn và có thể nâng cấp trong tương lai. Khả năng mở rộng hoặc thu hẹp của Dragon là ưu điểm lớn nhất khi nhóm từng thử nghiệm với một hệ thống ít nhất 10 camera hoặc nhiều nhất 100 camera tại một sân vận động nhưng vẫn hoạt động khá tốt. Premier League là giải đấu nổi tiếng về độ giàu có nên việc lựa chọn Dragon không hẳn đến từ chi phí hợp lý của nó. Giải pháp của Genius Sports đem đến sự mới mẻ về công nghệ, dễ triển khai và giúp thay thế một phần công nghệ VAR vốn đang gây nhiều tranh cãi trong gần 7 năm được áp dụng. Hoài Anh Theo Wired, hệ thống mới có tên Dragon, được phát triển bởi công ty dữ liệu và công nghệ thể thao Genius Sports và Second Spectrum. Ban tổ chức Premier League sẽ sử dụng trong tất cả trận đấu bắt đầu từ mùa giải này để thay thế hệ thống VAR với các tình huống bắt việt vị. Hàng chục iPhone đời mới sẽ giúp trọng tài đưa ra quyết định trong các tình huống bắt việt vị. Ảnh: DailyMail Công nghệ mới áp dụng dựa trên ít nhất 28 điện thoại đời iPhone 14 trở lên đặt xung quanh sân. Thiết bị sẽ được bọc trong vỏ chống nước và được trang bị quạt làm mát để hoạt động thời gian dài. Các máy sẽ quay video tốc độ khung hình cao từ nhiều góc độ khác nhau trên sân và truyền tín hiệu về phòng điều khiển. Vị trí điện thoại của Apple có thể khác nhau ở mỗi sân nhưng đặt cố định khi trận đấu diễn ra, tránh tình huống phải hiệu chỉnh lại phần mềm điều khiển.Điều làm Dragon trở nên độc đáo là khả năng theo dõi lượng lớn dữ liệu cho mỗi cầu thủ. Hệ thống có thể theo dõi từ 7.000 đến 10.000 điểm trên mỗi cầu thủ, ghi lại các chi tiết như đường nét cơ thể, khối lượng cơ và thậm chí cấu trúc xương. Mức độ chi tiết này giúp đảm bảo các quyết định việt vị chính xác hơn. Hệ thống ghi lại ở tốc độ tới 100 khung hình/giây giúp cung cấp các góc nhìn rõ hơn về thời điểm bóng rời chân cầu thủ chuyền bóng hay vị trí tương quan giữa hậu vệ và tiền đạo.Các máy iPhone gửi dữ liệu đến phần mềm AI để phân tích cảnh quay nhằm phát hiện tình huống việt vị. Tuy nhiên, ngay cả với công nghệ tiên tiến này, trọng tài vẫn sẽ là người đưa ra quyết định cuối cùng. Điều đó đồng nghĩa Dragon chỉ hỗ trợ chứ không có nhiệm vụ thay thế hoàn trọng tài.Ngoài cải thiện độ chính xác, giảm tranh cãi trong các tình huống phát hiện việt vị, Dragon có thể thêm nhiều công dụng khác trong tương lai như tạo ra bản sao kỹ thuật số của các cầu thủ để phân tích hành động. Chúng cũng có thể được sử dụng để hỗ trợ trọng tài trong những tình huống khác trên sân như thổi phạt, rút thẻ. Hệ thống Dragon sử dụng iPhone nhưng có thể theo dõi từ 7.000 đến 10.000 điểm trên mỗi cầu thủ. Ảnh: Genius Sports Công ty phát triển cho biết iPhone ngày nay mạnh mẽ như những siêu máy tính cách đây hơn 20 năm. Trong khi các hệ thống theo dõi quang học hiện đại khác đòi hỏi cáp quang đắt tiền, máy chủ để kết nối hay máy tính có nhiệm vụ quản lý dữ liệu được thu thập, một chiếc smartphone 1.000 USD có thể tự xử lý cả hai nhiệm vụ đó khá tốt.Đại diện Genius Sports cho biết hệ thống mới được nhiều giải bóng đá lớn khác quan tâm do dễ tùy biến, mức chi phí đầu tư không quá lớn và có thể nâng cấp trong tương lai. Khả năng mở rộng hoặc thu hẹp của Dragon là ưu điểm lớn nhất khi nhóm từng thử nghiệm với một hệ thống ít nhất 10 camera hoặc nhiều nhất 100 camera tại một sân vận động nhưng vẫn hoạt động khá tốt.Premier League là giải đấu nổi tiếng về độ giàu có nên việc lựa chọn Dragon không hẳn đến từ chi phí hợp lý của nó. Giải pháp của Genius Sports đem đến sự mới mẻ về công nghệ, dễ triển khai và giúp thay thế một phần công nghệ VAR vốn đang gây nhiều tranh cãi trong gần 7 năm được áp dụng. Hoài Anh",
                   "Oppo Find X8 Ultra được mệnh danh là một trong những kẻ hủy diệt mà Galaxy S24 Ultra cần phải lo ngại vừa lộ diện với trang bị cực khủng có thể sẽ là một bom tấn cao cấp đủ mạnh để khiến cả iPhone 15 Pro Max lo ngại. Chuyên gia rò rỉ Digital Chat Station mới đây đã chia sẻ thông tin chi tiết về màn hình của dòng Oppo Find X8 sắp ra mắt. Theo đó OPPO Find X8 Ultra và OnePlus 13 có thể có cùng màn hình cực kỳ xịn đủ sức khiến cả Galaxy S24 Ultra và iPhone 15 Pro Mã lo ngại. Hình ảnh do DCS công bố cho thấy màn hình phẳng với kính cong bốn cạnh có độ sâu bằng nhau. Rò rỉ cho thấy các thiết bị OnePlus 13, Oppo Find X8 Ultra và Find X8 Pro thực tế sẽ giống với hình ảnh. Người rò rỉ trước đó đã tiết lộ rằng OnePlus 13 và Oppo Find X8 Ultra có thể có cùng tấm nền LTPO OLED do BOE cung cấp. Cả hai điện thoại này dự kiến ​​sẽ có màn hình 6,8 inch với độ phân giải 1440 x 3168 pixel. Ngược lại, Find X8 Pro sẽ đi kèm với màn hình LTPO OLED 6,78 inch nhỏ hơn một chút, cung cấp độ phân giải 1264 x 2780 pixel. Người rò rỉ cũng đề cập rằng những thiết bị này không có giá đỡ bằng nhựa và viền của chúng ở cả bốn cạnh đều rất mỏng. Không giống như các thiết bị được đề cập ở trên, Find X8 sẽ có màn hình OLED hoàn toàn có kích thước khoảng 6,5 inch hoặc 6,6 inch. Nó được cho là hỗ trợ độ phân giải 1256 x 2760 pixel. Điều này có nghĩa là ở mức giá dự kiến rẻ hơn, OPPO Find X8 sẽ có thể hủy diệt các đối thủ dễ dàng. Find X8 và Find X8 Pro dự kiến ​​sẽ được trang bị chipset Dimensity 9400. Cả hai thiết bị này dự kiến ​​sẽ ra mắt vào tháng 10 năm 2024. Find X8 Ultra, được trang bị chipset Snapdragon 8 Gen 4 , dự kiến ​​sẽ ra mắt vào tháng 1 năm 2025. OnePlus 13 cũng dự kiến ​​sẽ sử dụng chip Snapdragon 8 Gen 4. Dự kiến ​​sản phẩm sẽ chính thức ra mắt vào tháng 10 hoặc tháng 11 năm nay. Oppo Find X8 Ultra được mệnh danh là một trong những kẻ hủy diệt mà Galaxy S24 Ultra cần phải lo ngại vừa lộ diện với trang bị cực khủng có thể sẽ là một bom tấn cao cấp đủ mạnh để khiến cả iPhone 15 Pro Max lo ngại. Chuyên gia rò rỉ Digital Chat Station mới đây đã chia sẻ thông tin chi tiết về màn hình của dòng Oppo Find X8 sắp ra mắt. Theo đó OPPO Find X8 Ultra và OnePlus 13 có thể có cùng màn hình cực kỳ xịn đủ sức khiến cả Galaxy S24 Ultra và iPhone 15 Pro Mã lo ngại. Hình ảnh do DCS công bố cho thấy màn hình phẳng với kính cong bốn cạnh có độ sâu bằng nhau. Rò rỉ cho thấy các thiết bị OnePlus 13, Oppo Find X8 Ultra và Find X8 Pro thực tế sẽ giống với hình ảnh. Người rò rỉ trước đó đã tiết lộ rằng OnePlus 13 và Oppo Find X8 Ultra có thể có cùng tấm nền LTPO OLED do BOE cung cấp. Cả hai điện thoại này dự kiến ​​sẽ có màn hình 6,8 inch với độ phân giải 1440 x 3168 pixel. Ngược lại, Find X8 Pro sẽ đi kèm với màn hình LTPO OLED 6,78 inch nhỏ hơn một chút, cung cấp độ phân giải 1264 x 2780 pixel. Người rò rỉ cũng đề cập rằng những thiết bị này không có giá đỡ bằng nhựa và viền của chúng ở cả bốn cạnh đều rất mỏng. Không giống như các thiết bị được đề cập ở trên, Find X8 sẽ có màn hình OLED hoàn toàn có kích thước khoảng 6,5 inch hoặc 6,6 inch. Nó được cho là hỗ trợ độ phân giải 1256 x 2760 pixel. Điều này có nghĩa là ở mức giá dự kiến rẻ hơn, OPPO Find X8 sẽ có thể hủy diệt các đối thủ dễ dàng. Find X8 và Find X8 Pro dự kiến ​​sẽ được trang bị chipset Dimensity 9400. Cả hai thiết bị này dự kiến ​​sẽ ra mắt vào tháng 10 năm 2024. Find X8 Ultra, được trang bị chipset Snapdragon 8 Gen 4 , dự kiến ​​sẽ ra mắt vào tháng 1 năm 2025. OnePlus 13 cũng dự kiến ​​sẽ sử dụng chip Snapdragon 8 Gen 4. Dự kiến ​​sản phẩm sẽ chính thức ra mắt vào tháng 10 hoặc tháng 11 năm nay. Smart Phone - Điện thoại Siêu phẩm flagship OPPO Find X8 lộ diện, bản Find X8 Ultra cực chất đe nẹt ngôi vị vua Android của Galaxy S24 Ultra 1 tuần trước Smart Phone - Điện thoại OPPO chuẩn bị ra mắt chiến thần sạc nhanh giá rẻ mới, ngang ngửa GAlaxy S24 Ultra chỉ hơn 6 triệu 2 tuần trước Tư vấn A-Z Đây là chiếc điện thoại OPPO giá rẻ hơn iPhone 11, màn hình lớn như iPhone 15 Pro Max, camera xịn như Galaxy S24 2 tuần trước Smart Phone - Điện thoại OPPO ra mắt siêu phẩm Android giá rẻ đẹp như iPhone 15 đạt chuẩn quân đội hơn cả Galaxy S24 Ultra 2 tuần trước Link gốc https://sohuutritue.net.vn/ke-huy-diet-gia-re-cua-galaxy-s24-ultra-tiet-lo-man-hinh-cuc-dep-hap-dan-hon-iphone-15-pro-max-d234203.html Tag: oppo find x8 pro Oppo"]
all_docs = relevant_docs + irrelevant_docs


expanded_query = rocchio_query_expansion(query, relevant_docs, irrelevant_docs, all_docs)
print("Truy vấn mở rộng:", expanded_query)

# def test_rocchio():
#     query = "thị trường chứng khoán"
#     relevant_docs = [
#         "Thị trường chứng khoán Việt Nam tăng trưởng mạnh",
#         "Nhà đầu tư quan tâm đến cổ phiếu ngân hàng"
#     ]
#     irrelevant_docs = [
#         "Giá dầu tăng khiến nhiều ngành công nghiệp gặp khó khăn"
#     ]
#     all_docs = relevant_docs + irrelevant_docs

#     expected_terms = set(["thị trường", "chứng khoán", "việt nam", "tăng trưởng", "cổ phiếu", "nhà đầu tư"])
    
#     expanded_query = rocchio_query_expansion(query, relevant_docs, irrelevant_docs, all_docs)
#     expanded_terms = set(expanded_query.split())
    
#     print("Expanded query:", expanded_query)
#     print("Expected terms:", expected_terms)
#     print("Actual terms:", expanded_terms)
#     print("Overlap:", expected_terms.intersection(expanded_terms))
#     print("Missing terms:", expected_terms - expanded_terms)
#     print("Extra terms:", expanded_terms - expected_terms)

# test_rocchio()

# def test_preprocessing():
#     text = "Thị trường chứng khoán Việt Nam tăng trưởng mạnh"
#     processed = preprocess_text(text)
#     print("Original:", text)
#     print("Processed:", processed)

# def test_tfidf():
#     docs = ["Thị trường chứng khoán", "Việt Nam tăng trưởng", "cổ phiếu ngân hàng"]
#     vectorizer = TfidfVectorizer(preprocessor=preprocess_text)
#     tfidf_matrix = vectorizer.fit_transform(docs)
#     print("Feature names:", vectorizer.get_feature_names_out())
#     print("TF-IDF matrix:\n", tfidf_matrix.toarray())

# test_preprocessing()
# test_tfidf()

def test_parameters():
    query = "iphone 13"
    relevant_docs = ["Dòng iPhone 13 tại Việt Nam hiện còn iPhone 13 được bán chính hãng nhưng iPhone 13 Pro Max vẫn đang rất hot vởi trang bị mạnh mẽ cao cấp không kém iPhone 15 Pro Max nhiều nhưng giá bán lại siêu rẻ.\
                  iPhone 13 là bước phát triển mạnh mẽ của Apple với dòng iPhone tai thỏ khi hoàn thiện công nghện \
                  này tới tối đa trước khi chuyển sang iPhone 14 với sự khởi đầu của Dynamic Island. \
                 Chính vì vậy iPhone 13 tiêu chuẩn hiện là chiếc iPhone đáng mua nhất hiện nay với giá bán hợp lý cho trang bị. \
                 Trong khi đó iPhone 13 Pro và iPhone 13 Pro Max lại đang làm mưa làm gió trên thị tường máy cũ nhờ trang bị quá mạnh không thua iPhone 15 Pro mới quá nhiều nhưng giá rẻ như bèo. Về cơ bản, iPhone 13 Pro Max và iPhone 13 Pro sở hữu quá nhiều trang bị cao cấp như chip A15 Bionic vẫn quá mạnh và đáp ứng tốt mọi nhu cầu của người dùng một cách ổn định, mượt mà. Camera cua máy với bộ ba ống kính có đủ zoom 3x, rộng và siêu rộng, có thể quay xóa phông vẫn là những thứ không thay đổi quá nhiều qua các thế hệ iPhone 14 và 15 kế tiếp. Trong khi đó, iPhone 13 với mức giá chỉ hơn 13 triệu đồng trong khi có màn OLED với tai thỏ đã thu gọn, camera với tính năng quay xóa phông xịn xò thực sự là lựa chọn khá hời hiện nay cho khách Việt. Dòng iPhone 13 tại Việt Nam hiện còn iPhone 13 được bán chính hãng nhưng iPhone 13 Pro Max vẫn đang rất hot vởi trang bị mạnh mẽ cao cấp không kém iPhone 15 Pro Max nhiều nhưng giá bán lại siêu rẻ. iPhone 13 là bước phát triển mạnh mẽ của Apple với dòng iPhone tai thỏ khi hoàn thiện công nghệ này tới tối đa trước khi chuyển sang iPhone 14 với sự khởi đầu của Dynamic Island. Chính vì vậy iPhone 13 tiêu chuẩn hiện là chiếc iPhone đáng mua nhất hiện nay với giá bán hợp lý cho trang bị. Trong khi đó iPhone 13 Pro và iPhone 13 Pro Max lại đang làm mưa làm gió trên thị tường máy cũ nhờ trang bị quá mạnh không thua iPhone 15 Pro mới quá nhiều nhưng giá rẻ như bèo. Bảng giá iPhone 13 trong tháng 8/2024 iPhone 13 (mới) iPhone 13 128GB: 13.19 triệu đồng iPhone 13 256GB: 16.29 triệu đồng iPhone 13 Pro Max cũ iPhone 13 Pro Max 128GB: 14.95 triệu đồng. iPhone 13 Pro Max 256GB: 16.05 triệu đồng iPhone 13 Pro Max 512GB: 17.35 triệu đồng iPhone 13 Pro cũ iPhone 13 Pro 128GB: 12.99 triệu đồng iPhone 13 Pro 256GB: 14.39 triệu đồng. iPhone 13 Pro 512GB: 15.19 triệu đồng iPhone 13 Mini (cũ) iPhone 13 Plus 128GB: 7.59 triệu đồng iPhone 13 Plus 256GB: 8.59 triệu đồng. Về cơ bản, iPhone 13 Pro Max và iPhone 13 Pro sở hữu quá nhiều trang bị cao cấp như chip A15 Bionic vẫn quá mạnh và đáp ứng tốt mọi nhu cầu của người dùng một cách ổn định, mượt mà. Camera cua máy với bộ ba ống kính có đủ zoom 3x, rộng và siêu rộng, có thể quay xóa phông vẫn là những thứ không thay đổi quá nhiều qua các thế hệ iPhone 14 và 15 kế tiếp. Trong khi đó, iPhone 13 với mức giá chỉ hơn 13 triệu đồng trong khi có màn OLED với tai thỏ đã thu gọn, camera với tính năng quay xóa phông xịn xò thực sự là lựa chọn khá hời hiện nay cho khách Việt. Smart Phone - Điện thoại Nút bấm mới trên iPhone 16 có gì \'hot\' mà khiến cộng đồng mạng sốt điên đảo 8 giờ trước Smart Phone - Điện thoại Rò rỉ thiết kế đỉnh nóc, kịch trần của Galaxy S25 Ultra, đẹp ăn đứt iPhone 16 Pro Max 22 giờ trước Tư vấn A-Z Đây là mẫu iPhone màn OLED, tai thỏ rẻ nhất thị trường, chỉ hơn 3 triệu, camera zoom như iPhone 15 hôm qua Tư vấn A-Z Đây là iPhone màn OLED cao cấp còn được hỗ trợ iOS giá rẻ nhất Việt Nam, vẫn mượt như iPhone 15 hôm qua Link gốc https://sohuutritue.net.vn/bang-gia-iphone-13-thang-8-2024-iphone-13-dap-hop-sieu-re-iphone-13-pro-max-van-cuc-hot-vi-qua-beo-d234242.html Tag: giá iphone 13 iphone 13", 
                ]
    irrelevant_docs = ["Ngoại hạng Anh dùng iPhone thay VAR bắt việt vị Từ mùa 2024-2025, giải Ngoại hạng Anh sẽ dùng hàng chục iPhone 14 hoặc mới hơn để phân tích các tình huống bắt việt vị hỗ trợ trọng tài. Theo Wired, hệ thống mới có tên Dragon, được phát triển bởi công ty dữ liệu và công nghệ thể thao Genius Sports và Second Spectrum. Ban tổ chức Premier League sẽ sử dụng trong tất cả trận đấu bắt đầu từ mùa giải này để thay thế hệ thống VAR với các tình huống bắt việt vị. Hàng chục iPhone đời mới sẽ giúp trọng tài đưa ra quyết định trong các tình huống bắt việt vị. Ảnh: DailyMail Công nghệ mới áp dụng dựa trên ít nhất 28 điện thoại đời iPhone 14 trở lên đặt xung quanh sân. Thiết bị sẽ được bọc trong vỏ chống nước và được trang bị quạt làm mát để hoạt động thời gian dài. Các máy sẽ quay video tốc độ khung hình cao từ nhiều góc độ khác nhau trên sân và truyền tín hiệu về phòng điều khiển. Vị trí điện thoại của Apple có thể khác nhau ở mỗi sân nhưng đặt cố định khi trận đấu diễn ra, tránh tình huống phải hiệu chỉnh lại phần mềm điều khiển. Điều làm Dragon trở nên độc đáo là khả năng theo dõi lượng lớn dữ liệu cho mỗi cầu thủ. Hệ thống có thể theo dõi từ 7.000 đến 10.000 điểm trên mỗi cầu thủ, ghi lại các chi tiết như đường nét cơ thể, khối lượng cơ và thậm chí cấu trúc xương. Mức độ chi tiết này giúp đảm bảo các quyết định việt vị chính xác hơn. Hệ thống ghi lại ở tốc độ tới 100 khung hình/giây giúp cung cấp các góc nhìn rõ hơn về thời điểm bóng rời chân cầu thủ chuyền bóng hay vị trí tương quan giữa hậu vệ và tiền đạo. Các máy iPhone gửi dữ liệu đến phần mềm AI để phân tích cảnh quay nhằm phát hiện tình huống việt vị. Tuy nhiên, ngay cả với công nghệ tiên tiến này, trọng tài vẫn sẽ là người đưa ra quyết định cuối cùng. Điều đó đồng nghĩa Dragon chỉ hỗ trợ chứ không có nhiệm vụ thay thế hoàn trọng tài. Ngoài cải thiện độ chính xác, giảm tranh cãi trong các tình huống phát hiện việt vị, Dragon có thể thêm nhiều công dụng khác trong tương lai như tạo ra bản sao kỹ thuật số của các cầu thủ để phân tích hành động. Chúng cũng có thể được sử dụng để hỗ trợ trọng tài trong những tình huống khác trên sân như thổi phạt, rút thẻ. Hệ thống Dragon sử dụng iPhone nhưng có thể theo dõi từ 7.000 đến 10.000 điểm trên mỗi cầu thủ. Ảnh: Genius Sports Công ty phát triển cho biết iPhone ngày nay mạnh mẽ như những siêu máy tính cách đây hơn 20 năm. Trong khi các hệ thống theo dõi quang học hiện đại khác đòi hỏi cáp quang đắt tiền, máy chủ để kết nối hay máy tính có nhiệm vụ quản lý dữ liệu được thu thập, một chiếc smartphone 1.000 USD có thể tự xử lý cả hai nhiệm vụ đó khá tốt. Đại diện Genius Sports cho biết hệ thống mới được nhiều giải bóng đá lớn khác quan tâm do dễ tùy biến, mức chi phí đầu tư không quá lớn và có thể nâng cấp trong tương lai. Khả năng mở rộng hoặc thu hẹp của Dragon là ưu điểm lớn nhất khi nhóm từng thử nghiệm với một hệ thống ít nhất 10 camera hoặc nhiều nhất 100 camera tại một sân vận động nhưng vẫn hoạt động khá tốt. Premier League là giải đấu nổi tiếng về độ giàu có nên việc lựa chọn Dragon không hẳn đến từ chi phí hợp lý của nó. Giải pháp của Genius Sports đem đến sự mới mẻ về công nghệ, dễ triển khai và giúp thay thế một phần công nghệ VAR vốn đang gây nhiều tranh cãi trong gần 7 năm được áp dụng. Hoài Anh Theo Wired, hệ thống mới có tên Dragon, được phát triển bởi công ty dữ liệu và công nghệ thể thao Genius Sports và Second Spectrum. Ban tổ chức Premier League sẽ sử dụng trong tất cả trận đấu bắt đầu từ mùa giải này để thay thế hệ thống VAR với các tình huống bắt việt vị. Hàng chục iPhone đời mới sẽ giúp trọng tài đưa ra quyết định trong các tình huống bắt việt vị. Ảnh: DailyMail Công nghệ mới áp dụng dựa trên ít nhất 28 điện thoại đời iPhone 14 trở lên đặt xung quanh sân. Thiết bị sẽ được bọc trong vỏ chống nước và được trang bị quạt làm mát để hoạt động thời gian dài. Các máy sẽ quay video tốc độ khung hình cao từ nhiều góc độ khác nhau trên sân và truyền tín hiệu về phòng điều khiển. Vị trí điện thoại của Apple có thể khác nhau ở mỗi sân nhưng đặt cố định khi trận đấu diễn ra, tránh tình huống phải hiệu chỉnh lại phần mềm điều khiển.Điều làm Dragon trở nên độc đáo là khả năng theo dõi lượng lớn dữ liệu cho mỗi cầu thủ. Hệ thống có thể theo dõi từ 7.000 đến 10.000 điểm trên mỗi cầu thủ, ghi lại các chi tiết như đường nét cơ thể, khối lượng cơ và thậm chí cấu trúc xương. Mức độ chi tiết này giúp đảm bảo các quyết định việt vị chính xác hơn. Hệ thống ghi lại ở tốc độ tới 100 khung hình/giây giúp cung cấp các góc nhìn rõ hơn về thời điểm bóng rời chân cầu thủ chuyền bóng hay vị trí tương quan giữa hậu vệ và tiền đạo.Các máy iPhone gửi dữ liệu đến phần mềm AI để phân tích cảnh quay nhằm phát hiện tình huống việt vị. Tuy nhiên, ngay cả với công nghệ tiên tiến này, trọng tài vẫn sẽ là người đưa ra quyết định cuối cùng. Điều đó đồng nghĩa Dragon chỉ hỗ trợ chứ không có nhiệm vụ thay thế hoàn trọng tài.Ngoài cải thiện độ chính xác, giảm tranh cãi trong các tình huống phát hiện việt vị, Dragon có thể thêm nhiều công dụng khác trong tương lai như tạo ra bản sao kỹ thuật số của các cầu thủ để phân tích hành động. Chúng cũng có thể được sử dụng để hỗ trợ trọng tài trong những tình huống khác trên sân như thổi phạt, rút thẻ. Hệ thống Dragon sử dụng iPhone nhưng có thể theo dõi từ 7.000 đến 10.000 điểm trên mỗi cầu thủ. Ảnh: Genius Sports Công ty phát triển cho biết iPhone ngày nay mạnh mẽ như những siêu máy tính cách đây hơn 20 năm. Trong khi các hệ thống theo dõi quang học hiện đại khác đòi hỏi cáp quang đắt tiền, máy chủ để kết nối hay máy tính có nhiệm vụ quản lý dữ liệu được thu thập, một chiếc smartphone 1.000 USD có thể tự xử lý cả hai nhiệm vụ đó khá tốt.Đại diện Genius Sports cho biết hệ thống mới được nhiều giải bóng đá lớn khác quan tâm do dễ tùy biến, mức chi phí đầu tư không quá lớn và có thể nâng cấp trong tương lai. Khả năng mở rộng hoặc thu hẹp của Dragon là ưu điểm lớn nhất khi nhóm từng thử nghiệm với một hệ thống ít nhất 10 camera hoặc nhiều nhất 100 camera tại một sân vận động nhưng vẫn hoạt động khá tốt.Premier League là giải đấu nổi tiếng về độ giàu có nên việc lựa chọn Dragon không hẳn đến từ chi phí hợp lý của nó. Giải pháp của Genius Sports đem đến sự mới mẻ về công nghệ, dễ triển khai và giúp thay thế một phần công nghệ VAR vốn đang gây nhiều tranh cãi trong gần 7 năm được áp dụng. Hoài Anh",
                   "Oppo Find X8 Ultra được mệnh danh là một trong những kẻ hủy diệt mà Galaxy S24 Ultra cần phải lo ngại vừa lộ diện với trang bị cực khủng có thể sẽ là một bom tấn cao cấp đủ mạnh để khiến cả iPhone 15 Pro Max lo ngại. Chuyên gia rò rỉ Digital Chat Station mới đây đã chia sẻ thông tin chi tiết về màn hình của dòng Oppo Find X8 sắp ra mắt. Theo đó OPPO Find X8 Ultra và OnePlus 13 có thể có cùng màn hình cực kỳ xịn đủ sức khiến cả Galaxy S24 Ultra và iPhone 15 Pro Mã lo ngại. Hình ảnh do DCS công bố cho thấy màn hình phẳng với kính cong bốn cạnh có độ sâu bằng nhau. Rò rỉ cho thấy các thiết bị OnePlus 13, Oppo Find X8 Ultra và Find X8 Pro thực tế sẽ giống với hình ảnh. Người rò rỉ trước đó đã tiết lộ rằng OnePlus 13 và Oppo Find X8 Ultra có thể có cùng tấm nền LTPO OLED do BOE cung cấp. Cả hai điện thoại này dự kiến ​​sẽ có màn hình 6,8 inch với độ phân giải 1440 x 3168 pixel. Ngược lại, Find X8 Pro sẽ đi kèm với màn hình LTPO OLED 6,78 inch nhỏ hơn một chút, cung cấp độ phân giải 1264 x 2780 pixel. Người rò rỉ cũng đề cập rằng những thiết bị này không có giá đỡ bằng nhựa và viền của chúng ở cả bốn cạnh đều rất mỏng. Không giống như các thiết bị được đề cập ở trên, Find X8 sẽ có màn hình OLED hoàn toàn có kích thước khoảng 6,5 inch hoặc 6,6 inch. Nó được cho là hỗ trợ độ phân giải 1256 x 2760 pixel. Điều này có nghĩa là ở mức giá dự kiến rẻ hơn, OPPO Find X8 sẽ có thể hủy diệt các đối thủ dễ dàng. Find X8 và Find X8 Pro dự kiến ​​sẽ được trang bị chipset Dimensity 9400. Cả hai thiết bị này dự kiến ​​sẽ ra mắt vào tháng 10 năm 2024. Find X8 Ultra, được trang bị chipset Snapdragon 8 Gen 4 , dự kiến ​​sẽ ra mắt vào tháng 1 năm 2025. OnePlus 13 cũng dự kiến ​​sẽ sử dụng chip Snapdragon 8 Gen 4. Dự kiến ​​sản phẩm sẽ chính thức ra mắt vào tháng 10 hoặc tháng 11 năm nay. Oppo Find X8 Ultra được mệnh danh là một trong những kẻ hủy diệt mà Galaxy S24 Ultra cần phải lo ngại vừa lộ diện với trang bị cực khủng có thể sẽ là một bom tấn cao cấp đủ mạnh để khiến cả iPhone 15 Pro Max lo ngại. Chuyên gia rò rỉ Digital Chat Station mới đây đã chia sẻ thông tin chi tiết về màn hình của dòng Oppo Find X8 sắp ra mắt. Theo đó OPPO Find X8 Ultra và OnePlus 13 có thể có cùng màn hình cực kỳ xịn đủ sức khiến cả Galaxy S24 Ultra và iPhone 15 Pro Mã lo ngại. Hình ảnh do DCS công bố cho thấy màn hình phẳng với kính cong bốn cạnh có độ sâu bằng nhau. Rò rỉ cho thấy các thiết bị OnePlus 13, Oppo Find X8 Ultra và Find X8 Pro thực tế sẽ giống với hình ảnh. Người rò rỉ trước đó đã tiết lộ rằng OnePlus 13 và Oppo Find X8 Ultra có thể có cùng tấm nền LTPO OLED do BOE cung cấp. Cả hai điện thoại này dự kiến ​​sẽ có màn hình 6,8 inch với độ phân giải 1440 x 3168 pixel. Ngược lại, Find X8 Pro sẽ đi kèm với màn hình LTPO OLED 6,78 inch nhỏ hơn một chút, cung cấp độ phân giải 1264 x 2780 pixel. Người rò rỉ cũng đề cập rằng những thiết bị này không có giá đỡ bằng nhựa và viền của chúng ở cả bốn cạnh đều rất mỏng. Không giống như các thiết bị được đề cập ở trên, Find X8 sẽ có màn hình OLED hoàn toàn có kích thước khoảng 6,5 inch hoặc 6,6 inch. Nó được cho là hỗ trợ độ phân giải 1256 x 2760 pixel. Điều này có nghĩa là ở mức giá dự kiến rẻ hơn, OPPO Find X8 sẽ có thể hủy diệt các đối thủ dễ dàng. Find X8 và Find X8 Pro dự kiến ​​sẽ được trang bị chipset Dimensity 9400. Cả hai thiết bị này dự kiến ​​sẽ ra mắt vào tháng 10 năm 2024. Find X8 Ultra, được trang bị chipset Snapdragon 8 Gen 4 , dự kiến ​​sẽ ra mắt vào tháng 1 năm 2025. OnePlus 13 cũng dự kiến ​​sẽ sử dụng chip Snapdragon 8 Gen 4. Dự kiến ​​sản phẩm sẽ chính thức ra mắt vào tháng 10 hoặc tháng 11 năm nay. Smart Phone - Điện thoại Siêu phẩm flagship OPPO Find X8 lộ diện, bản Find X8 Ultra cực chất đe nẹt ngôi vị vua Android của Galaxy S24 Ultra 1 tuần trước Smart Phone - Điện thoại OPPO chuẩn bị ra mắt chiến thần sạc nhanh giá rẻ mới, ngang ngửa GAlaxy S24 Ultra chỉ hơn 6 triệu 2 tuần trước Tư vấn A-Z Đây là chiếc điện thoại OPPO giá rẻ hơn iPhone 11, màn hình lớn như iPhone 15 Pro Max, camera xịn như Galaxy S24 2 tuần trước Smart Phone - Điện thoại OPPO ra mắt siêu phẩm Android giá rẻ đẹp như iPhone 15 đạt chuẩn quân đội hơn cả Galaxy S24 Ultra 2 tuần trước Link gốc https://sohuutritue.net.vn/ke-huy-diet-gia-re-cua-galaxy-s24-ultra-tiet-lo-man-hinh-cuc-dep-hap-dan-hon-iphone-15-pro-max-d234203.html Tag: oppo find x8 pro Oppo"]
    all_docs = relevant_docs + irrelevant_docs

    # for alpha in [0.6, 0.8, 1.0]:
    #     for beta in [0.1, 0.2, 0.3, 0.75]:
    #         gamma = 1 - alpha - beta
    #         print(f"Alpha: {alpha}, Beta: {beta}, Gamma: {gamma}")
    #         expanded_query = rocchio_query_expansion(query, relevant_docs, irrelevant_docs, all_docs, alpha, beta, gamma)
    #         print("Expanded query:", expanded_query)
    #         print()

    # # print(f"Alpha: {alpha}, Beta: {beta}, Gamma: {gamma}")
    expanded_query = rocchio_query_expansion(query, relevant_docs, irrelevant_docs, all_docs, 1.0, 0.75, 0.15)
    print("Expanded query:", expanded_query)
    print()

test_parameters()